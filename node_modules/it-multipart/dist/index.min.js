(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.ItMultipart = factory()}(typeof self !== 'undefined' ? self : this, function () {
"use strict";var ItMultipart=(()=>{var S=Object.create;var f=Object.defineProperty;var M=Object.getOwnPropertyDescriptor;var _=Object.getOwnPropertyNames;var j=Object.getPrototypeOf,A=Object.prototype.hasOwnProperty;var I=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports),P=(r,t)=>{for(var e in t)f(r,e,{get:t[e],enumerable:!0})},m=(r,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let u of _(t))!A.call(r,u)&&u!==e&&f(r,u,{get:()=>t[u],enumerable:!(n=M(t,u))||n.enumerable});return r};var U=(r,t,e)=>(e=r!=null?S(j(r)):{},m(t||!r||!r.__esModule?f(e,"default",{value:r,enumerable:!0}):e,r)),V=r=>m(f({},"__esModule",{value:!0}),r);var w=I(()=>{});var B={};P(B,{default:()=>y});var x=U(w(),1);var a=class{constructor(t){if(!(t>0)||t-1&t)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(t),this.mask=t-1,this.top=0,this.btm=0,this.next=null}push(t){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=t,this.top=this.top+1&this.mask,!0)}shift(){let t=this.buffer[this.btm];if(t!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,t}isEmpty(){return this.buffer[this.btm]===void 0}},o=class{constructor(t={}){this.hwm=t.splitLimit??16,this.head=new a(this.hwm),this.tail=this.head,this.size=0}calculateSize(t){return t?.byteLength!=null?t.byteLength:1}push(t){if(t?.value!=null&&(this.size+=this.calculateSize(t.value)),!this.head.push(t)){let e=this.head;this.head=e.next=new a(2*this.head.buffer.length),this.head.push(t)}}shift(){let t=this.tail.shift();if(t===void 0&&this.tail.next!=null){let e=this.tail.next;this.tail.next=null,this.tail=e,t=this.tail.shift()}return t?.value!=null&&(this.size-=this.calculateSize(t.value)),t}isEmpty(){return this.head.isEmpty()}};function c(r={}){return q(e=>{let n=e.shift();if(n==null)return{done:!0};if(n.error!=null)throw n.error;return{done:n.done===!0,value:n.value}},r)}function q(r,t){t=t??{};let e=t.onEnd,n=new o,u,s,l,g=async()=>n.isEmpty()?l?{done:!0}:await new Promise((i,L)=>{s=N=>{s=null,n.push(N);try{i(r(n))}catch(k){L(k)}return u}}):r(n),b=i=>s!=null?s(i):(n.push(i),u),E=i=>(n=new o,s!=null?s({error:i}):(n.push({error:i}),u)),p=i=>{if(l)return u;if(t?.objectMode!==!0&&i?.byteLength==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return b({done:!1,value:i})},d=i=>l?u:(l=!0,i!=null?E(i):b({done:!0})),v=()=>(n=new o,d(),{done:!0}),z=i=>(d(i),{done:!0});if(u={[Symbol.asyncIterator](){return this},next:g,return:v,throw:z,push:p,end:d,get readableLength(){return n.size}},e==null)return u;let h=u;return u={[Symbol.asyncIterator](){return this},next(){return h.next()},throw(i){return h.throw(i),e!=null&&(e(i),e=void 0),{done:!0}},return(){return h.return(),e!=null&&(e(),e=void 0),{done:!0}},push:p,end(i){return h.end(i),e!=null&&(e(i),e=void 0),u},get readableLength(){return h.readableLength}},u}async function*y(r){let t=c({objectMode:!0});if(r==null){t.end(new Error("request missing")),yield*t;return}let e=(0,x.default)({keepExtensions:!0});e.parse(r,n=>{t.end(n)}),e.onPart=n=>{let u=c();n.on("data",s=>{u.push(s)}),n.on("end",()=>{u.end()}),n.on("error",s=>{u.end(s)}),t.push({headers:n.headers,body:u})},yield*t}return V(B);})();
return ItMultipart}));
